services:
  server:
    build:
      context: ./chat-server
      dockerfile: Dockerfile
    image: chat-app-server:latest
    environment:
      CHAT_SERVER_ADDR: ":8080"
    ports:
      - "8080:8080"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "bash -lc 'exec 3<>/dev/tcp/127.0.0.1/8080'"]
      interval: 3s
      timeout: 2s
      retries: 10
      start_period: 2s

  client:
    build:
      context: ./chat-client
      dockerfile: Dockerfile
    image: chat-app-client:latest
    depends_on:
      server:
        condition: service_healthy
    stdin_open: true
    tty: true
    entrypoint: ["/app/chat-client"]
    profiles: ["client"]

networks:
  default:
    name: chat-app-net
